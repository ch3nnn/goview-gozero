var j=(b,w,r)=>new Promise((_,o)=>{var f=s=>{try{i(r.next(s))}catch(p){o(p)}},q=s=>{try{i(r.throw(s))}catch(p){o(p)}},i=s=>s.done?_(s.value):Promise.resolve(s.value).then(f,q);i((r=r.apply(b,w)).next())});import{d as F,$ as k,j as H,aR as z,J,r as n,o as A,D as P,w as t,b as e,n as U,e as u,t as v,u as a,h as G,bf as K,O as W,a1 as X,b9 as Y,cB as Z,c as ee,d2 as E,bs as te,ab as O,bt as ae}from"./index-312a31dd.js";import{i as oe}from"./icon-ce016406.js";import{S as I}from"./SettingItem-dba63559.js";import{S as R}from"./SettingItemBox-19ac3d74.js";import"./chartEditStore-32c50897.js";/* empty css                                                                      */import{u as L}from"./useTargetData.hook-a2ff4133.js";import{R as ne,a as se}from"./pondIndex.vue_vue_type_style_index_0_scoped_bc18493e_lang-0fe5d698.js";import{u as le}from"./useSync.hook-4d532843.js";import"./index-db9727f7.js";import"./EditorWorker-4b89d885.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-a3dfb071.js";import"./index-5e1011db.js";import{C as re}from"./index-36efc9a9.js";import"./plugin-aa00071a.js";import"./project.api-bec812dd.js";import"./index-d277f175.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-da631111.js";import"./index.esm.min-f20ed2aa.js";import"./fileTypeEnum-21359a08.js";const ue={class:"go-pr-3"},ce=F({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(b,{emit:w}){const r=b,_=w,{targetData:o}=L(),{dataSyncUpdate:f}=le(),{chartConfig:q}=k(r.targetData),{requestContentType:i}=k(r.targetData.request),s=H(!1),p={[z.DEFAULT]:"普通请求",[z.SQL]:"SQL 请求"};J(()=>r.modelShow,g=>{s.value=g},{immediate:!0});const m=()=>{_("update:modelShow",!1),_("sendHandle"),f()};return(g,h)=>{const x=n("n-space"),y=n("n-scrollbar"),D=n("n-text"),S=n("n-tag"),B=n("n-button"),c=n("n-card"),l=n("n-modal");return A(),P(l,{class:"go-chart-data-request",show:s.value,"onUpdate:show":h[0]||(h[0]=d=>s.value=d),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(c,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(x,{justify:"space-between"},{default:t(()=>[U("div",null,[e(D,null,{default:t(()=>[u("「 "+v(a(q).categoryName)+" 」",1)]),_:1}),e(D,null,{default:t(()=>[u("—— ")]),_:1}),e(S,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:t(()=>[u(v(p[a(i)]),1)]),_:1})]),e(B,{type:"primary",onClick:m},{default:t(()=>[u(v(b.saveBtnText||"保存 & 发送请求"),1)]),_:1})]),_:1})]),default:t(()=>[e(y,{style:{"max-height":"718px"}},{default:t(()=>[U("div",ue,[e(x,{vertical:""},{default:t(()=>{var d;return[e(a(ne)),e(a(se),{"target-data-request":(d=a(o))==null?void 0:d.request},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),de=G(ce,[["__scopeId","data-v-3ec3a7fe"]]),ie={class:"go-chart-configurations-data-ajax"},pe={class:"go-absolute-center"},me=F({__name:"index",setup(b){K(c=>({"272613bc":B.value}));const{HelpOutlineIcon:w,FlashIcon:r,PulseIcon:_}=oe.ionicons5,{targetData:o,chartEditStore:f}=L(),{requestOriginUrl:q,requestInterval:i,requestIntervalUnit:s}=k(f.getRequestGlobalConfig),p=W(),m=H(!1),g=H(!1),h=H(!1);let x=0,y;const D=()=>{g.value=!0},S=()=>j(this,null,function*(){var c;if((c=o.value)!=null&&c.request){m.value=!0;try{const l=yield te(O(o.value.request),O(f.getRequestGlobalConfig));if(m.value=!1,l){const{data:d}=l;if(!d&&!o.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),h.value=!0;return}o.value.option.dataset=ae(d,l,o.value.filter),h.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(l){console.error(l),m.value=!1,window.$message.warning("数据异常，请检查参数！")}}}),B=X(()=>p.getAppTheme);return Y(()=>{var l;const c=(l=o.value)==null?void 0:l.filter;y!==c&&x&&(y=c,S()),x++}),Z(()=>{y=null}),(c,l)=>{const d=n("n-tag"),C=n("n-input"),T=n("n-icon"),$=n("n-button"),N=n("n-card"),V=n("n-tooltip"),M=n("go-skeleton");return A(),ee("div",ie,[e(N,{class:"n-card-shallow"},{default:t(()=>[e(a(R),{name:"请求配置"},{default:t(()=>[e(a(I),{name:"类型"},{default:t(()=>[e(d,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:t(()=>[u(v(a(o).request.requestContentType===a(z).DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),e(a(I),{name:"方式"},{default:t(()=>[e(C,{size:"small",placeholder:a(o).request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(I),{name:"组件间隔"},{default:t(()=>[e(C,{size:"small",placeholder:`${a(o).request.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[u(v(a(E)[a(o).request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(I),{name:"全局间隔（默认）"},{default:t(()=>[e(C,{size:"small",placeholder:`${a(i)||"暂无"} `,disabled:!0},{suffix:t(()=>[u(v(a(E)[a(s)]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(R),{name:"源地址",alone:!0},{default:t(()=>[e(C,{size:"small",placeholder:a(q)||"暂无",disabled:!0},{prefix:t(()=>[e(T,{component:a(_)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(R),{name:"组件地址",alone:!0},{default:t(()=>[e(C,{size:"small",placeholder:a(o).request.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(T,{component:a(r)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),U("div",{class:"edit-text",onClick:D},[U("div",pe,[e($,{type:"primary",secondary:""},{default:t(()=>[u("编辑配置")]),_:1})])])]),_:1}),e(a(R),{alone:!0},{name:t(()=>[u(" 测试 "),e(V,{trigger:"hover"},{trigger:t(()=>[e(T,{size:"21",depth:3},{default:t(()=>[e(a(w))]),_:1})]),default:t(()=>[u(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e($,{type:"primary",ghost:"",onClick:S},{icon:t(()=>[e(T,null,{default:t(()=>[e(a(r))]),_:1})]),default:t(()=>[u(" 发送请求 ")]),_:1})]),_:1}),e(a(re),{show:h.value&&!m.value,ajax:!0},null,8,["show"]),e(M,{load:m.value,repeat:3},null,8,["load"]),e(a(de),{modelShow:g.value,"onUpdate:modelShow":l[0]||(l[0]=Q=>g.value=Q),targetData:a(o),onSendHandle:S},null,8,["modelShow","targetData"])])}}});const je=G(me,[["__scopeId","data-v-688badbe"]]);export{je as default};
