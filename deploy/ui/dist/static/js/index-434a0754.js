var fe=Object.defineProperty,ge=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var le=(s,c,l)=>c in s?fe(s,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[c]=l,Q=(s,c)=>{for(var l in c||(c={}))he.call(c,l)&&le(s,l,c[l]);if(se)for(var l of se(c))be.call(c,l)&&le(s,l,c[l]);return s},W=(s,c)=>ge(s,ve(c));var de=(s,c,l)=>new Promise((f,C)=>{var x=i=>{try{m(l.next(i))}catch(g){C(g)}},_=i=>{try{m(l.throw(i))}catch(g){C(g)}},m=i=>i.done?f(i.value):Promise.resolve(i.value).then(x,_);m((l=l.apply(s,c)).next())});import{d as L,j as T,J as K,r as o,o as u,D as z,w as t,b as e,e as h,c as S,n as p,u as a,h as V,bf as _e,O as pe,$ as ee,a1 as G,a6 as ae,F as J,q as ne,av as re,t as F,s as ye,x as qe,l as xe,d3 as A,aR as X,d2 as ce,aS as M,ad as we,L as Pe,aO as ue,ab as Z,b9 as De,cB as Ie,bs as Ce,bt as Se}from"./index-312a31dd.js";import{i as te}from"./icon-ce016406.js";/* empty css                                                                      */import{S as N}from"./SettingItemBox-19ac3d74.js";import{r as ke}from"./chartEditStore-32c50897.js";import{n as Re}from"./noData-e5cefb25.js";import{u as oe}from"./useTargetData.hook-a2ff4133.js";import{g as me}from"./plugin-aa00071a.js";import"./index-db9727f7.js";import{R as $e,a as Oe}from"./pondIndex.vue_vue_type_style_index_0_scoped_bc18493e_lang-0fe5d698.js";import"./EditorWorker-4b89d885.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-a3dfb071.js";import{l as Ee}from"./index-5e1011db.js";import{u as He}from"./useSync.hook-4d532843.js";import{S as j}from"./SettingItem-dba63559.js";import{C as Te}from"./index-36efc9a9.js";import"./index-d277f175.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-da631111.js";import"./index.esm.min-f20ed2aa.js";import"./fileTypeEnum-21359a08.js";import"./project.api-bec812dd.js";const Ue={class:"go-pr-3"},ze={key:1},Ne=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(s,{emit:c}){const l=s,f=c,{dataSyncUpdate:C}=He();T();const x=T(),_=T(!1);K(()=>l.modelShow,g=>{_.value=g});const m=()=>{f("update:modelShow",!1)},i=()=>{var g,y;if(!((g=l.targetDataRequest)!=null&&g.dataPondName)){window.$message.warning("请在左下角输入名称！"),(y=x.value)==null||y.focus();return}me({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{f("update:modelShow",!1),f("editSaveHandle",l.targetDataRequest),C()}})};return(g,y)=>{const d=o("n-space"),k=o("n-scrollbar"),w=o("n-tag"),q=o("n-input"),O=o("n-button"),E=o("n-card"),P=o("n-modal");return u(),z(P,{class:"go-chart-data-request",show:_.value,"onUpdate:show":y[1]||(y[1]=D=>_.value=D),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(E,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(d,{justify:"space-between"},{default:t(()=>[s.targetDataRequest?(u(),z(d,{key:0},{default:t(()=>[e(w,{bordered:!1,type:"primary"},{default:t(()=>[h("名称：")]),_:1}),e(q,{value:s.targetDataRequest.dataPondName,"onUpdate:value":y[0]||(y[0]=D=>s.targetDataRequest.dataPondName=D),ref_key:"inputInstRef",ref:x,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(u(),S("span",ze)),e(d,null,{default:t(()=>[e(O,{onClick:m},{default:t(()=>[h("取消")]),_:1}),e(O,{type:"primary",onClick:i},{default:t(()=>[h("保存")]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(k,{style:{"max-height":"718px"}},{default:t(()=>[p("div",Ue,[e(d,{vertical:""},{default:t(()=>{var D;return[e(a($e)),e(a(Oe),{"target-data-request":(D=s.targetDataRequest)==null?void 0:D.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Be=V(Ne,[["__scopeId","data-v-bc18493e"]]),Ae=s=>(ye("data-v-43dfb7fe"),s=s(),qe(),s),Fe={class:"go-chart-data-pond-list"},je={class:"pond-item-box"},Le=Ae(()=>p("span",null," 创建 ",-1)),Me=["onClick"],Ge={class:"item-content"},Ve={class:"item-content-body"},Je=["onClick"],Ye=L({__name:"index",emits:["createPond","deletePond"],setup(s,{emit:c}){_e(q=>({"1013e1a5":y.value}));const l=c,{DuplicateOutlineIcon:f,TrashIcon:C}=te.ionicons5,x=pe(),{chartEditStore:_,targetData:m}=oe(),{requestDataPond:i}=ee(_.getRequestGlobalConfig),g=G(()=>m.value.request.requestDataPondId),y=G(()=>x.getAppTheme),d=()=>{l("createPond",!0)},k=(q,O)=>{q.stopPropagation(),q.preventDefault(),l("deletePond",O)},w=q=>{m.value.request.requestDataPondId=q.dataPondId};return(q,O)=>{const E=o("n-timeline-item"),P=o("n-timeline"),D=o("n-icon"),B=o("n-button"),I=o("n-divider"),n=o("n-a"),r=o("n-text"),b=o("n-space"),R=o("n-tag"),U=o("n-ellipsis"),v=o("n-scrollbar");return u(),S("div",Fe,[e(P,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e(E,{type:"info"}),e(E,{type:"success"})]),_:1}),p("div",je,[e(B,{class:"create-btn go-py-4",ghost:"",onClick:d},{icon:t(()=>[e(D,null,{default:t(()=>[e(a(f))]),_:1})]),default:t(()=>[Le]),_:1}),e(I,{style:{margin:"10px 0"}}),a(i).length?ae("",!0):(u(),z(b,{key:0,justify:"center"},{default:t(()=>[e(r,{class:"not-layer-text",depth:3},{default:t(()=>[h(" 暂无数据内容， "),e(n,{onClick:d},{default:t(()=>[h("立即创建")]),_:1})]),_:1})]),_:1})),e(v,{style:{"max-height":"490px"}},{default:t(()=>[(u(!0),S(J,null,ne(a(i),$=>(u(),S("div",{key:$.dataPondId,class:re([{select:$.dataPondId===g.value},"pond-item"]),onClick:H=>w($)},[p("div",Ge,[p("div",Ve,[p("div",null,[e(R,{class:"go-mr-1",type:$.dataPondId===g.value?"warning":"",bordered:!1},{default:t(()=>[h(" 名称 ")]),_:2},1032,["type"]),e(U,{style:{"max-width":"180px"}},{default:t(()=>[h(F($.dataPondName||"暂无"),1)]),_:2},1024)]),p("div",null,[e(R,{class:"go-mr-1",type:$.dataPondId===g.value?"warning":"",bordered:!1},{default:t(()=>[h(" 地址 ")]),_:2},1032,["type"]),e(U,{style:{"max-width":"180px"}},{default:t(()=>[h(F($.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),p("div",{class:"item-content-icon go-transition-quick",onClick:H=>k(H,$)},[e(D,null,{default:t(()=>[e(a(C))]),_:1})],8,Je)]),p("div",{class:re({"select-modal":$.dataPondId===g.value})},null,2)],10,Me))),128))]),_:1})])])}}});const Qe=V(Ye,[["__scopeId","data-v-43dfb7fe"]]),We=p("thead",null,[p("tr",null,[p("th",null,"key"),p("th",null,"value")])],-1),ie=L({__name:"displayTable",props:{target:Object},setup(s){const c=s,l={key:"",value:""},f=xe({content:[]});return K(()=>c.target,C=>{f.content=[];for(const x in C)f.content.push({key:x,value:C[x]});f.content.length||(f.content=[JSON.parse(JSON.stringify(l))])},{immediate:!0,deep:!0}),(C,x)=>{const _=o("n-table");return u(),z(_,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[We,p("tbody",null,[(u(!0),S(J,null,ne(f.content,(m,i)=>(u(),S("tr",{key:i},[p("td",null,F(m.key||"暂无"),1),p("td",null,F(m.value||"暂无"),1)]))),128))])]),_:1})}}}),Xe={class:"go-chart-data-display"},Ke={class:"go-mr-3"},Ze={key:0},et={class:"go-mt-3"},tt={key:0},at={key:1},nt={key:1},ot=L({__name:"index",props:{globalData:Object,targetData:Object},setup(s){const c=s,{HelpOutlineIcon:l,FlashIcon:f,PulseIcon:C}=te.ionicons5,{requestUrl:x,requestInterval:_,requestHttpType:m,requestContentType:i,requestSQLContent:g,requestParams:y,requestParamsBodyType:d,requestIntervalUnit:k}=ee(c.targetData.dataPondRequestConfig);A.HEADER;const w={[X.DEFAULT]:"普通请求",[X.SQL]:"SQL 请求"},q=T(A.PARAMS);return(O,E)=>{const P=o("n-input"),D=o("n-icon"),B=o("n-divider"),I=o("n-tab"),n=o("n-tabs"),r=o("n-text"),b=o("n-card"),R=o("n-code"),U=o("n-scrollbar");return u(),S("div",Xe,[e(U,{style:{"max-height":"570px"}},{default:t(()=>[p("div",Ke,[p("div",null,[e(a(N),{name:"主体信息"},{default:t(()=>[e(a(j),{name:"接口名称"},{default:t(()=>{var v;return[e(P,{size:"small",placeholder:((v=s.targetData)==null?void 0:v.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(a(j),{name:"接口类型"},{default:t(()=>[e(P,{size:"small",placeholder:a(m)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(a(N),null,{default:t(()=>[e(a(j),{name:"组件间隔"},{default:t(()=>[e(P,{size:"small",placeholder:`${a(_)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(F(s.targetData&&a(ce)[a(k)]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(j),{name:"全局间隔（默认）"},{default:t(()=>{var v;return[e(P,{size:"small",placeholder:`${((v=s.globalData)==null?void 0:v.requestInterval)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(F(s.globalData&&a(ce)[s.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(a(N),{name:"源地址",alone:!0},{default:t(()=>{var v;return[e(P,{size:"small",placeholder:((v=s.globalData)==null?void 0:v.requestOriginUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(D,{component:a(C)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(N),{name:"接口地址",alone:!0},{default:t(()=>[e(P,{size:"small",placeholder:a(x)||"暂无",disabled:!0},{prefix:t(()=>[e(D,{component:a(f)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(B),e(a(N),{name:"类型"},{default:t(()=>[e(a(j),{name:"配置类型"},{default:t(()=>[e(P,{size:"small",placeholder:s.targetData&&w[a(i)],disabled:!0},null,8,["placeholder"])]),_:1}),a(i)===a(X).DEFAULT?(u(),z(a(j),{key:0,name:"body 类型"},{default:t(()=>[e(P,{size:"small",placeholder:s.targetData&&a(d),disabled:!0},null,8,["placeholder"])]),_:1})):ae("",!0)]),_:1}),a(i)===a(X).DEFAULT?(u(),S("div",Ze,[e(n,{type:"line",animated:"",value:q.value,"onUpdate:value":E[0]||(E[0]=v=>q.value=v)},{default:t(()=>[(u(!0),S(J,null,ne(a(A),v=>(u(),z(I,{key:v,name:v,tab:v},{default:t(()=>[h(F(v),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),p("div",et,[q.value!==a(A).BODY?(u(),S("div",tt,[e(ie,{class:"go-my-3",target:a(y)[q.value]},null,8,["target"])])):(u(),S("div",at,[a(d)===a(M).NONE?(u(),z(b,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e(r,{depth:"3"},{default:t(()=>[h("该接口没有 Body 体")]),_:1})]),_:1})):a(d)===a(M).FORM_DATA||a(d)===a(M).X_WWW_FORM_URLENCODED?(u(),z(ie,{key:1,class:"go-my-3",target:a(y)[a(A).BODY][a(d)]},null,8,["target"])):a(d)===a(M).JSON?(u(),z(b,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(R,{code:a(y)[a(A).BODY][a(d)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):a(d)===a(M).XML?(u(),z(R,{key:3,code:a(y)[a(A).BODY][a(d)]||"",language:"html"},null,8,["code"])):ae("",!0)]))])])):(u(),S("div",nt,[e(a(N),{name:"键名"},{default:t(()=>[e(r,null,{default:t(()=>[h("sql")]),_:1})]),_:1}),e(a(N),{name:"键值"},{default:t(()=>[e(R,{code:a(g).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const st=V(ot,[["__scopeId","data-v-cc877db2"]]),lt={class:"pond-content"},dt={key:1,class:"no-data go-flex-center"},rt=["src"],ct=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(s,{emit:c}){const l=s,f=c,{PencilIcon:C}=te.ionicons5,{chartEditStore:x,targetData:_}=oe(),{requestDataPond:m}=ee(x.getRequestGlobalConfig),i=T(!1),g=T(!1),y=T(!1),d=T(!1),k=T(),w=G(()=>{var b,R;const n=(R=(b=_==null?void 0:_.value)==null?void 0:b.request)==null?void 0:R.requestDataPondId;return n?m.value.filter(U=>n===U.dataPondId)[0]:void 0});K(()=>l.modelShow,n=>{g.value=n}),K(()=>w.value,n=>{y.value=!0,k.value=n,we(()=>{y.value=!1})},{immediate:!0});const q=(n=!1)=>{d.value=!!n,i.value=!0},O=()=>{const n=Pe();k.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:Ee.cloneDeep(W(Q({},ke),{requestDataType:ue.Pond}))},q()},E=n=>{d.value?P(n):D(n),d.value=!1,i.value=!1},P=n=>{try{const r=m.value.findIndex(b=>b.dataPondId===n.dataPondId);r!==-1?(m.value.splice(r,1,n),x.getComponentList.forEach(b=>{b.request.requestDataType===ue.Pond&&b.request.requestDataPondId===n.dataPondId&&(b.request=W(Q({},Z(n.dataPondRequestConfig)),{requestDataPondId:n.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(r){window.$message.error("编辑失败，请稍后重试！")}},D=n=>{try{k.value?(m.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(r){window.$message.error("创建失败，请稍后重试!")}},B=n=>{me({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const r=m.value.findIndex(b=>b.dataPondId===n.dataPondId);r!==-1?(m.value.splice(r,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},I=()=>{w.value&&(_.value.request=W(Q({},Z(w.value.dataPondRequestConfig)),{requestDataPondId:w.value.dataPondId})),f("update:modelShow",!1),f("sendHandle")};return(n,r)=>{const b=o("n-text"),R=o("n-icon"),U=o("n-button"),v=o("n-space"),$=o("n-card"),H=o("n-modal");return u(),S(J,null,[e(H,{class:"go-chart-data-pond-control",show:g.value,"onUpdate:show":r[1]||(r[1]=Y=>g.value=Y),"mask-closable":!1,"close-on-esc":!1},{default:t(()=>[e($,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(v,{justify:"space-between"},{default:t(()=>[e(U,{type:"info",secondary:"",disabled:!w.value,onClick:r[0]||(r[0]=Y=>q(!0))},{icon:t(()=>[e(R,null,{default:t(()=>[e(a(C))]),_:1})]),default:t(()=>[h(" 编辑内容 ")]),_:1},8,["disabled"]),e(U,{type:"primary",onClick:I},{default:t(()=>[h("保存 & 发送请求")]),_:1})]),_:1})]),default:t(()=>[p("div",lt,[w.value&&!y.value?(u(),z(a(st),{key:0,targetData:w.value,globalData:a(x).getRequestGlobalConfig},null,8,["targetData","globalData"])):(u(),S("div",dt,[p("img",{src:a(Re),alt:"暂无数据"},null,8,rt),e(b,{depth:3},{default:t(()=>[h("暂未选择公共接口")]),_:1})])),e(a(Qe),{onCreatePond:O,onDeletePond:B})])]),_:1})]),_:1},8,["show"]),e(a(Be),{modelShow:i.value,"onUpdate:modelShow":r[2]||(r[2]=Y=>i.value=Y),targetDataRequest:k.value,isEdit:d.value,onEditSaveHandle:E},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const ut=V(ct,[["__scopeId","data-v-993e2797"]]),it={class:"go-chart-data-pond"},_t={class:"go-absolute-center"},pt=L({__name:"index",setup(s){_e(I=>({"5189590e":P.value}));const c=pe(),{HelpOutlineIcon:l,FlashIcon:f,PulseIcon:C,FishIcon:x}=te.ionicons5,{targetData:_,chartEditStore:m}=oe(),{requestDataPond:i,requestInterval:g,requestIntervalUnit:y}=ee(m.getRequestGlobalConfig),d=T(!1),k=T(!1),w=T(!1);let q=0,O;const E=G(()=>{const I=_.value.request.requestDataPondId;return I?i.value.filter(r=>I===r.dataPondId)[0]:void 0}),P=G(()=>c.getAppTheme),D=()=>{k.value=!0},B=()=>de(this,null,function*(){var I;if(!((I=_.value)!=null&&I.request)){window.$message.warning("请选择一个公共接口！");return}d.value=!0;try{const n=yield Ce(Z(_.value.request),Z(m.getRequestGlobalConfig));if(d.value=!1,n){if(!(n!=null&&n.data)&&!_.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),w.value=!0;return}_.value.option.dataset=Se(n==null?void 0:n.data,n,_.value.filter),w.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(n){console.error(n),d.value=!1,window.$message.warning("数据异常，请检查参数！")}});return De(()=>{var n;const I=(n=_.value)==null?void 0:n.filter;O!==I&&q&&(O=I,B()),q++}),Ie(()=>{O=null}),(I,n)=>{const r=o("n-icon"),b=o("n-input"),R=o("n-button"),U=o("n-card"),v=o("n-tooltip"),$=o("go-skeleton");return u(),S(J,null,[p("div",it,[e(U,{class:"n-card-shallow"},{default:t(()=>[e(a(N),{name:"请求名称",alone:!0},{default:t(()=>{var H;return[e(b,{size:"small",placeholder:((H=E.value)==null?void 0:H.dataPondName)||"暂无",disabled:!0},{prefix:t(()=>[e(r,{component:a(x)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(N),{name:"接口地址",alone:!0},{default:t(()=>{var H;return[e(b,{size:"small",placeholder:((H=E.value)==null?void 0:H.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(r,{component:a(f)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),p("div",{class:"edit-text",onClick:D},[p("div",_t,[e(R,{type:"primary",secondary:""},{default:t(()=>[h("编辑配置")]),_:1})])])]),_:1})]),e(a(N),{alone:!0},{name:t(()=>[h(" 测试 "),e(v,{trigger:"hover"},{trigger:t(()=>[e(r,{size:"21",depth:3},{default:t(()=>[e(a(l))]),_:1})]),default:t(()=>[h(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(R,{type:"primary",ghost:"",onClick:B},{icon:t(()=>[e(r,null,{default:t(()=>[e(a(f))]),_:1})]),default:t(()=>[h(" 发送请求 ")]),_:1})]),_:1}),e(a(Te),{show:w.value&&!d.value,ajax:!0},null,8,["show"]),e($,{load:d.value,repeat:3},null,8,["load"]),e(a(ut),{modelShow:k.value,"onUpdate:modelShow":n[0]||(n[0]=H=>k.value=H),onSendHandle:B},null,8,["modelShow"])],64)}}});const zt=V(pt,[["__scopeId","data-v-19fefd48"]]);export{zt as default};
