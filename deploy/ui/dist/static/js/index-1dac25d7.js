var d=(v,f,i)=>new Promise((S,u)=>{var g=a=>{try{n(i.next(a))}catch(c){u(c)}},r=a=>{try{n(i.throw(a))}catch(c){u(c)}},n=a=>a.done?S(a.value):Promise.resolve(a.value).then(g,r);n((i=i.apply(v,f)).next())});import{M as B}from"./EditorWorker-4b89d885.js";import"./editorWorker-43a98755.js";import{d as D,j as J,aI as w,aJ as L,ak as M,aK as E,aL as R,aM as j,c as A,b as t,w as o,aF as F,r as s,o as y,n as K,e as p,u as m,D as x,a6 as O,h as z}from"./index-312a31dd.js";import{g as G}from"./storage-32b9bf70.js";import"./querySelectorAll-a1c431d2.js";import{g as b}from"./plugin-aa00071a.js";import{i as H}from"./icon-ce016406.js";import{u as U}from"./useSync.hook-4d532843.js";import{u as q,P as Q}from"./chartEditStore-32c50897.js";import"./project.api-bec812dd.js";import"./chartLayoutStore-a3dfb071.js";import"./index-5e1011db.js";import"./SettingItem-dba63559.js";/* empty css                                                                      */import"./SettingItemBox-19ac3d74.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-da631111.js";import"./index.esm.min-f20ed2aa.js";import"./fileTypeEnum-21359a08.js";const W={class:"go-edit"},X=D({__name:"index",setup(v){const f=q(),{dataSyncUpdate:i}=U(),{ChevronBackOutlineIcon:S,DownloadIcon:u,AnalyticsIcon:g}=H.ionicons5,r=window.showOpenFilePicker,n=J("");window.$message.warning("请不要刷新此窗口！");function a(){return d(this,null,function*(){const e=yield G();F(`编辑-${e.editCanvasConfig.projectName}`),n.value=E(e)})}setTimeout(a);function c(){b({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const _=yield(yield r())[0].getFile(),l=new FileReader;l.readAsText(_),l.onloadend=()=>{n.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(w.CHART,e=>{window.$message.success("正在进行更新..."),L(M.GO_CHART_STORAGE_LIST,[e.detail]),n.value=E(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),C())});function C(){return d(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");b({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const e=R(n.value);delete e.id,i&&(f.setProjectInfo(Q.PROJECT_ID,j()),yield i(!1)),window.opener.dispatchEvent(new CustomEvent(w.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}})})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(w.CLOSE))},(e,_)=>{const l=s("n-text"),k=s("n-icon"),h=s("n-button"),I=s("n-tag"),P=s("n-space"),N=s("n-layout-header"),T=s("n-layout-content"),$=s("n-layout");return y(),A("div",W,[t($,null,{default:o(()=>[t(N,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[K("div",null,[t(l,{class:"go-edit-title go-mr-4"},{default:o(()=>[p("页面在线编辑器")]),_:1}),m(r)?(y(),x(h,{key:0,class:"go-mr-3",size:"medium",onClick:c},{icon:o(()=>[t(k,null,{default:o(()=>[t(m(u))]),_:1})]),default:o(()=>[p(" 导入 ")]),_:1})):O("",!0)]),t(P,null,{default:o(()=>[t(I,{bordered:!1,type:"warning"},{default:o(()=>[p(" 「Ctrl + S 更新视图」 ")]),_:1}),m(r)?(y(),x(h,{key:0,class:"go-mr-3",size:"medium",onClick:C},{icon:o(()=>[t(k,null,{default:o(()=>[t(m(g))]),_:1})]),default:o(()=>[p(" 保存 ")]),_:1})):O("",!0)]),_:1})]),_:1}),t(T,null,{default:o(()=>[t(m(B),{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=V=>n.value=V),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const we=z(X,[["__scopeId","data-v-13e14cec"]]);export{we as default};
